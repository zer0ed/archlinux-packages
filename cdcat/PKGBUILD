# Contributor: Wes Brewer <brewerw@gmail.com>
pkgname=cdcat
pkgver=1.01b
pkgrel=3
pkgdesc="CD & Disk catalog software."
arch=(i686)
url="http://cdcat.sourceforge.net/"
license=('GPL')
depends=('pcre' 'qt')
source=(http://cdcat.sourceforge.net/$pkgname-$pkgver.tar.bz2 cdcat.patch \
        cdcat.desktop)
md5sums=('59b321ff3848b34cb6862fd2a408cb44' '25e6202887a45b1f977d647bf3f05154'\
         '1ad7d21d77dd4f9d0b56216fe54f61ce')

build() {
  cd $startdir/src/CdCat-$pkgver/src
  # apply patches (GGC 4.1, mp3 off-by-one)
  patch -p0 < ../../cdcat.patch
  qmake cdcat.pro && make || return 1
  make INSTALL_ROOT=$startdir/pkg install

  # move /usr/local/bin to /usr/bin
  cp -rf $startdir/pkg/usr/local/bin $startdir/pkg/usr/bin
  rm -r $startdir/pkg/usr/local

  # menu link, pixmap icon, and mimetype
  cd $startdir/src/CdCat-$pkgver/KDE
  mkdir -p $startdir/pkg/usr/share/mime/packages/
  cp x-hcf.xml $startdir/pkg/usr/share/mime/packages/
  mkdir -p $startdir/pkg/usr/share/pixmaps/
  cp ../cdcat.png $startdir/pkg/usr/share/pixmaps/
  mkdir -p $startdir/pkg/usr/share/applications/
  cp ../../cdcat.desktop $startdir/pkg/usr/share/applications/
}
